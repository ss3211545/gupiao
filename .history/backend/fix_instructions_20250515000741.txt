# 服务器修复指南

问题: 当前应用无法访问根路径 ("/")，导致404错误

## 修复步骤:

1. 首先安装编辑器 (如果没有):
   ```
   sudo yum install nano
   ```
   或
   ```
   sudo apt-get install nano
   ```

2. 备份原始文件:
   ```
   cp app/__init__.py app/__init__.py.bak
   cp app/routes.py app/routes.py.bak
   ```

3. 编辑 app/__init__.py 文件:
   ```
   nano app/__init__.py
   ```
   
   修改为以下内容:
   ```python
   from flask import Flask
   from flask_socketio import SocketIO
   from flask_cors import CORS
   
   socketio = SocketIO()
   
   def create_app():
       app = Flask(__name__, 
                   static_folder='../static',
                   template_folder='../templates')
       
       app.config['SECRET_KEY'] = 'tailmarket-stock-app-secret-key'
       
       # 允许跨域请求
       CORS(app)
       
       # 注册蓝图
       from app.api import api_bp
       app.register_blueprint(api_bp, url_prefix='/api')
       
       # 导入并注册主路由
       from app.routes import index, health
       
       # 注册路由
       app.route('/')(index)
       app.route('/health')(health)
       
       # 初始化SocketIO
       socketio.init_app(app, cors_allowed_origins="*")
       
       return app
   ```

4. 编辑 app/routes.py 文件:
   ```
   nano app/routes.py
   ```
   
   修改为以下内容:
   ```python
   from flask import render_template, Blueprint, jsonify
   
   # Define the functions without creating a new app instance
   
   def index():
       """首页路由，加载Vue应用"""
       return render_template('index.html')
   
   def health():
       """健康检查路由"""
       return jsonify({'status': 'ok', 'version': '1.0.0'})
   
   # These routes will be registered in the main app in __init__.py
   ```

5. 重启应用:
   ```
   python3 run.py
   ```

## 如果无法安装编辑器，可使用以下命令:

1. 更新 routes.py:
   ```
   cat > app/routes.py << 'EOL'
   from flask import render_template, Blueprint, jsonify
   
   # Define the functions without creating a new app instance
   
   def index():
       """首页路由，加载Vue应用"""
       return render_template('index.html')
   
   def health():
       """健康检查路由"""
       return jsonify({'status': 'ok', 'version': '1.0.0'})
   
   # These routes will be registered in the main app in __init__.py
   EOL
   ```

2. 更新 __init__.py:
   ```
   cat > app/__init__.py << 'EOL'
   from flask import Flask
   from flask_socketio import SocketIO
   from flask_cors import CORS
   
   socketio = SocketIO()
   
   def create_app():
       app = Flask(__name__, 
                   static_folder='../static',
                   template_folder='../templates')
       
       app.config['SECRET_KEY'] = 'tailmarket-stock-app-secret-key'
       
       # 允许跨域请求
       CORS(app)
       
       # 注册蓝图
       from app.api import api_bp
       app.register_blueprint(api_bp, url_prefix='/api')
       
       # 导入并注册主路由
       from app.routes import index, health
       
       # 注册路由
       app.route('/')(index)
       app.route('/health')(health)
       
       # 初始化SocketIO
       socketio.init_app(app, cors_allowed_origins="*")
       
       return app
   EOL
   ``` 